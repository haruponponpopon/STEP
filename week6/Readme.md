# å‰å›žã®å¾©ç¿’  
ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¯ã»ã©ã»ã©ã«è¡Œã†  

åº§æ¨™(x,y)ã®ã¨ãã¯ArrayOfStructã«ã™ã‚‹ã¨å‡¦ç†ãŒã—ã‚„ã™ã„ã€‚(èª­ã¿è¾¼ã¿ã®æ™‚ã«StructOfArrayãŒæ›¸ãã‚„ã™ã‹ã£ãŸã®ã§ãã£ã¡ã«ã—ãŸã‚‰ã€é€†ã«ã™ã‚Œã°ã‚ˆã‹ã£ãŸã¨å¾Œã€…å¾Œæ‚”ã—ãªãŒã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã—ãŸã€ã€ã€ãŠã£ã—ã‚ƒã‚‹é€šã‚Šã ã¨æ€ã„ã¾ã™ã€‚)  

1è¡Œã®bufferã®å¤‰æ•°åã¯lineãŒè‰¯ã„  

åº§æ¨™ã®ãƒªã‚¹ãƒˆã®ã¨ãã¯å¤‰æ•°åã¯è¤‡æ•°å½¢  

å…¥åŠ›ãŒç©ºã®é…åˆ—ã®å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã®ã§ã€ãã®å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹ã‹ç©ºã®é…åˆ—ã¯å‡¦ç†ã§ããªã„æ—¨ã‚’documentã«æ›¸ãã€‚  

size_tã‚’é©åˆ‡ã«ä½¿ã†ã“ã¨ã§caseã›ãšã«æ¸ˆã‚€  
->å…ˆæ—¥vectorã‚„stringã§ã™ã¨size_tã®ä½¿ã„æ–¹ãŒã‚ˆãã‚ã‹ã‚‰ãªãã¦ã€intã«castã™ã‚‹ã“ã¨ã§.size()ã‚’ä½¿ãŠã†ã¨æ€ã£ã¦ã„ãŸã®ã§ã™ãŒã€å…·ä½“çš„ã«vectorã‚„stringã®ã¨ãã¯size_tã¯ã©ã®ã‚ˆã†ã«ä½¿ãˆã°ã‚ˆã‚ã—ã„ã®ã§ã—ã‚‡ã†ã‹ã€‚  

æœ€å°å€¤ã‚’æ±‚ã‚ãŸã„æ™‚ã¯æœ€å°å€¤ã‚’æ ¼ç´ã™ã‚‹å¤‰æ•°ã«åˆã‚ã«ã‚‚ã®ã™ã”ãå¤§ããªå€¤ã‚’å…¥ã‚Œã¦ãŠãã¨æ¯”è¼ƒå›žæ•°ãŒæ¸›ã‚‹ã€‚  

äº¤å·®ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã§ã¯ãªãswapã™ã‚‹ã“ã¨ã§è·é›¢ãŒçŸ­ãã§ãã‚‹ã‹ã¨ã„ã†è¦³ç‚¹ã‹ã‚‰æ”»ã‚ã‚‹ã¨ã‚³ãƒ¼ãƒ‰ãŒç°¡å˜ã«æ›¸ã‘ã‚‹ã—è¨ˆç®—æ™‚é–“ã‚‚æ¸›ã‚‹ã€‚  

# ä»Šå›žã®èª²é¡Œ  
kadai.cã¯best_fitã¨worst_fitã‚’æ„šç›´ã«å®Ÿè£…ã—ãŸmalloc.cã§ã™ã€‚282è¡Œç›®ã‹ã‚‰284è¡Œç›®ã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ã§bestã‚„worstã®ã©ã®æŒ™å‹•ã«ã™ã‚‹ã‹ã‚’æ±ºã‚ã‚‰ã‚Œã¾ã™ã€‚è¾žæ›¸ã‚’ç”¨ã„ã¦é«˜é€ŸåŒ–ã‚’å›³ã£ãŸã‚³ãƒ¼ãƒ‰ãŒreal_mallocãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­ã«å…¥ã£ã¦ã„ã¾ã™ã€‚

# è€ƒãˆãŸã“ã¨  
åˆã‚ã«æ„šç›´ã«å‰ã‹ã‚‰è¦‹ã¦ã„ãbest_fitã¨worst_fitã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ æ™‚é–“ã¯ã‹ã‹ã‚Šã¾ã™ãŒã€best_fitã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŽ‡ã«ç€ç›®ã™ã‚‹ã¨ã€ 
best_fitãŒåŠ¹çŽ‡ãŒè‰¯ã•ãã†ã§ã™ã€‚  
best_fitã‚’é«˜é€Ÿã«å®Ÿè£…ã™ã‚‹ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¦è€ƒãˆã¾ã—ãŸã€‚
|  first_fit ||  best_fit  ||  worst_fit  ||  best_fit(è¾žæ›¸)  ||
| ---- | ---- |---- | ---- |---- | ---- | ---- | ---- |
|  11ms  |  70%  |  1797ms  |  70%  |  1766ms  |  70%  |  13ms  |  65%  |
|  8ms  |  40%  |  789ms  |  40%  |  814ms  |  40%  |  12ms  |  31%  |
|  148ms  |  7%  |  939ms  |  50%  |  91725ms  |  4%  |  12ms  |  43%  |
|  39221ms  |  15%  |  15428ms  |  71%  |  927073ms  |  7%  |  37ms  |  70%  |
|  31553ms  |  15%  |  10906ms  |  74%  |  807980ms  |  7%  |  24ms  |  73%  |

best_fitã¯é©åˆã™ã‚‹æœ€å°ã®ãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’æŽ¢ã™ã®ã§ã€ã¾ãšåˆã‚ã«äºŒåˆ†æŽ¢ç´¢ãŒå€™è£œã«ä¸ŠãŒã‚Šã¾ã—ãŸã€‚first_fitã§ã¯æ§‹é€ ä½“metadataã¯sizeã¨ãƒã‚¤ãƒ³ã‚¿nextã‚’æ‰€æŒã—ã¾ã™ãŒã€
nextã®ä»£ã‚ã‚Šã«rightã¨leftã®ãƒã‚¤ãƒ³ã‚¿ã‚’æ‰€æŒã—ã€å­ãƒŽãƒ¼ãƒ‰ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã¨ã—ã¾ã™ã€‚ã¾ãŸã€æ§‹é€ ä½“my_heapã®free_headã¯å¸¸ã«ä¸€ç•ªä¸Šã®è¦ªãƒŽãƒ¼ãƒ‰ã‚’ç¤ºã™ã“ã¨ã§ã€
å¸¸ã«free_headã‹ã‚‰ã€è¦ä»¶ã«è¦‹åˆã†ç©ºãé ˜åŸŸã‚’logNã§æŽ¢ã™ã“ã¨ãŒã§ãã¾ã™ã€‚  
è¦ªãƒŽãƒ¼ãƒ‰ã‚’å›ºå®šã¨ã™ã‚‹äºŒåˆ†æœ¨ã§å®Ÿéš›ã«å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸãŒã€ã†ã¾ãã„ã‹ãš(ãƒŽãƒ¼ãƒ‰ã®å‰Šé™¤ã®ä¸‹ã‚Šã‚’é–“é•ãˆã¦ã„ã¾ã—ãŸ)ã€ãƒ‡ãƒãƒƒã‚°ä¸­ã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¦‹ã¦ã€åŒã˜æ•°å­—ãŒãŸãã•ã‚“å…¥ã£ã¦ãã‚‹ã“ã¨ã«æ°—ãŒã¤ãã¾ã—ãŸã€‚
ãƒŽãƒ¼ãƒ‰ã®å‰Šé™¤ã®ä¸‹ã‚ŠãŒãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒç…©é›‘ã«ãªã£ã¦è¨³ãŒã‚ã‹ã‚‰ãªããªã£ã¦ããŸã®ã§æ–¹é‡ã‚’å¤‰ãˆã¾ã™ã€‚  
ãã“ã§ã€sizeã¯æœ€å¤§ã§4000ã¨ã„ã†åˆ¶ç´„ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚ã—ã‹ã‚‚8ã®å€æ•°ã€‚ã“ã‚Œã¯è¾žæ›¸ã®å‡ºç•ªã§ã™ã€‚ç©ºãé ˜åŸŸ8,16,24,,,ã¨å…ˆé ­ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é…åˆ—ã«å…¥ã‚Œã¦ã€
æ®‹ã‚Šã¯ã‚¿ã‚°ã‚’ç”¨ã„ãŸãƒã‚¤ãƒ³ã‚¿æ¸¡ã—ã§åŒæ–¹å‘ãƒªã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã„ã‘ãã†ã§ã™ã€‚(ã†ã¾ãã„ãã¾ã›ã‚“ã§ã—ãŸã€ã€ã€â†’ãƒ¡ãƒ³ã‚¿ãƒ¼ã•ã‚“ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«ã‚ˆã‚Šå‹•ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸðŸŽ‰)

### ä»¥ä¸‹ã®ã‚ˆã†ãªè¾žæ›¸ã‚’ç”¨æ„ã™ã‚‹  
|  size |  å…ˆé ­ã¸ã®ãƒã‚¤ãƒ³ã‚¿  |
| ---- | ---- |
| 0 | NULL |
| 8 | NULL |
| 16 | *a |
| 24 | NULL |
| 32 | NULL |
| 40 | *b |
| :  |  : |
| 4096 | NULL |

è¾žæ›¸(16)->a->c->d    
è¾žæ›¸(40)->b    
ã¨ãƒã‚¤ãƒ³ã‚¿ã‚’æ¸¡ã—ã¦ã„ã  
ã‚¿ã‚°ã«ã¯ç©ºãé ˜åŸŸã®ã‚µã‚¤ã‚ºã€ä»–ã®ç©ºãé ˜åŸŸã‚’æŒ‡ã—ç¤ºã™nextã¨prevã‚’æŒã¤ã€‚  
ãƒ¡ãƒ¢ãƒªã®ä¸­èº«
```
| ãƒ‡ãƒ¼ã‚¿ | ã‚¢ãƒ‰ãƒ¬ã‚¹a size=16  next=*c, prev=è¾žæ›¸[16]| ãƒ‡ãƒ¼ã‚¿| ã‚¢ãƒ‰ãƒ¬ã‚¹b size=40 next=NULL prev=è¾žæ›¸[40]| ãƒ‡ãƒ¼ã‚¿ | 
->ç¶šã|ã‚¢ãƒ‰ãƒ¬ã‚¹c size=16 next=*d, prev=*a| ãƒ‡ãƒ¼ã‚¿ | ã‚¢ãƒ‰ãƒ¬ã‚¹d size=16 next=NULL, prev=*c|ãƒ‡ãƒ¼ã‚¿|
```

### æ–°ã—ãç©ºãé ˜åŸŸãŒç™ºç”Ÿã—ãŸã‚‰ 
ä¾‹ãˆã°size 24ã®ã‚¢ãƒ‰ãƒ¬ã‚¹eã®ç©ºãé ˜åŸŸãŒç™ºç”Ÿã—ãŸã‚‰ã€è¾žæ›¸ã®size=24ã®ã¨ã“ã‚ã‚’*eã«ã—ã¦ã‚¿ã‚°ã¯size=24, next=NULL, prev=è¾žæ›¸[24]ã¨ã™ã‚‹ã€‚

è¾žæ›¸(16)->a->c->d   
è¾žæ›¸(24)->NULL  
è¾žæ›¸(40)->b  
â†“  
è¾žæ›¸(16)->a->c->d   
è¾žæ›¸(24)->e  
è¾žæ›¸(40)->b 

ä¾‹ãˆã°size 16ã®ã‚¢ãƒ‰ãƒ¬ã‚¹fã®ç©ºãé ˜åŸŸãŒç™ºç”Ÿã—ãŸã‚‰ã€è¾žæ›¸ã®size=16ã®ã¨ã“ã‚ã‚’*fã«ã—ã¦ã‚¿ã‚°ã¯size=16, next=*a, prev=è¾žæ›¸[16]ã¨ã™ã‚‹ã€‚  
è¾žæ›¸(16)->a->c->d   
è¾žæ›¸(24)->NULL  
è¾žæ›¸(40)->b  
â†“  
è¾žæ›¸(16)->f->a->c->d   
è¾žæ›¸(24)->e  
è¾žæ›¸(40)->b 

### é ˜åŸŸã®å‰Šé™¤  
ä¾‹ãˆã°size16ã€ã‚¢ãƒ‰ãƒ¬ã‚¹cã®ç©ºãé ˜åŸŸãŒå‰Šé™¤ã•ã‚ŒãŸã‚‰ã€ç©ºãé ˜åŸŸcã®ã‚¿ã‚°ã«ã‚ã‚‹nextã¨prevã‚’è¦‹ã‚‹ã€‚next=*d, prev=*aãªã®ã§
a->nextã‚’dã«ã€d->prevã‚’aã«ã™ã‚‹ã€‚    
è¾žæ›¸(16)->a->d    
è¾žæ›¸(40)->b   

ä¾‹ãˆã°size40ã€ã‚¢ãƒ‰ãƒ¬ã‚¹bã®ç©ºãé ˜åŸŸãŒå‰Šé™¤ã•ã‚ŒãŸã‚‰ã€ç©ºãé ˜åŸŸbã®ã‚¿ã‚°ã«ã‚ã‚‹nextã¨prevã‚’è¦‹ã‚‹ã€‚next=NULL, prev=è¾žæ›¸[40]ãªã®ã§
è¾žæ›¸[40].å…ˆé ­ã¸ã®ãƒã‚¤ãƒ³ã‚¿=NULLã«ã™ã‚‹ã€‚    
è¾žæ›¸(16)->a->c->d    
è¾žæ›¸(40)->NULL   

ä¾‹ãˆã°size16ã€ã‚¢ãƒ‰ãƒ¬ã‚¹dã®ç©ºãé ˜åŸŸãŒå‰Šé™¤ã•ã‚ŒãŸã‚‰ã€ç©ºãé ˜åŸŸdã®ã‚¿ã‚°ã«ã‚ã‚‹nextã¨prevã‚’è¦‹ã‚‹ã€‚next=NULL, prev=*cãªã®ã§ã€c->nextã‚’
NULLã«ã™ã‚‹ã€‚  
è¾žæ›¸(16)->a->c->NULL    
è¾žæ›¸(40)->b   
